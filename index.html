<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apex Drift: Extreme Garage</title>
    <style>
        :root { --neon: #00f2ff; --nitro: #ff00ea; }
        body { margin: 0; overflow: hidden; background: #000; font-family: 'Arial Black', sans-serif; }
        #ui { position: absolute; inset: 0; pointer-events: none; z-index: 10; color: white; }
        
        /* Speedo & Nitro */
        #speed-box { position: absolute; bottom: 40px; right: 50px; text-align: right; }
        #kmh { font-size: 70px; font-style: italic; line-height: 0.8; }
        #nitro-bar { position: absolute; top: 40px; left: 50%; transform: translateX(-50%); width: 300px; height: 8px; background: rgba(255,255,255,0.1); border: 2px solid white; border-radius: 10px; overflow: hidden; }
        #nitro-fill { width: 100%; height: 100%; background: var(--neon); box-shadow: 0 0 15px var(--neon); }

        /* Garage Controls */
        #garage-ui { position: absolute; top: 40px; left: 40px; pointer-events: auto; }
        .car-name { font-size: 30px; text-transform: uppercase; color: var(--neon); margin-bottom: 5px; }
        .btn { background: white; color: black; border: none; padding: 10px 20px; font-weight: bold; cursor: pointer; clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); margin-top: 10px; }
        
        #loading { position: fixed; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 100; letter-spacing: 5px; }
    </style>
</head>
<body>

<div id="loading">DOWNLOADED FROM ASPHALT CLOUD...</div>

<div id="ui">
    <div id="garage-ui">
        <div id="display-name" class="car-name">FERRARI 458</div>
        <div style="font-size: 14px; color: #888;">CLASS S HYPERCAR</div>
        <button class="btn" onclick="switchCar()">NEXT CAR >> </button>
    </div>

    <div id="nitro-bar"><div id="nitro-fill"></div></div>
    
    <div id="speed-box">
        <div id="kmh">0</div>
        <div style="color: var(--neon); font-size: 18px;">KM/H</div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
const scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x000000, 30, 150);

const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// LIGHTS
scene.add(new THREE.AmbientLight(0xffffff, 0.7));
const light = new THREE.DirectionalLight(0xffffff, 1.5);
light.position.set(5, 10, 5);
scene.add(light);

// THE WORLD
const grid = new THREE.GridHelper(2000, 100, 0x00f2ff, 0x222222);
scene.add(grid);

// --- THE 1 LAKH CARS SYSTEM ---
const carGarage = [
    { name: "Ferrari 458 Italia", url: "https://raw.githubusercontent.com/mrdoob/three.js/master/examples/models/gltf/Ferrari.glb", scale: 1.5 },
    { name: "Lamborghini Aventador", url: "https://raw.githubusercontent.com/ramjigeddam/3d/master/Lamborginhi%20Aventador_test.glb", scale: 0.02 },
    { name: "McLaren P1 Concept", url: "https://raw.githubusercontent.com/mrdoob/three.js/master/examples/models/gltf/Ferrari.glb", scale: 1.6 } // Placeholder link
];

let currentCarIndex = 0;
let carObject = null;
const loader = new THREE.GLTFLoader();

function loadCar(index) {
    document.getElementById('loading').style.display = 'flex';
    if (carObject) scene.remove(carObject);

    const data = carGarage[index];
    document.getElementById('display-name').innerText = data.name;

    loader.load(data.url, (gltf) => {
        carObject = gltf.scene;
        carObject.scale.set(data.scale, data.scale, data.scale);
        carObject.rotation.y = Math.PI;
        scene.add(carObject);
        document.getElementById('loading').style.display = 'none';
    });
}

function switchCar() {
    currentCarIndex = (currentCarIndex + 1) % carGarage.length;
    loadCar(currentCarIndex);
}

loadCar(0); // Load first car

// DRIVING LOGIC
let speed = 0;
let nitro = 100;
const keys = {};
window.onkeydown = (e) => keys[e.code] = true;
window.onkeyup = (e) => keys[e.code] = false;

function animate() {
    requestAnimationFrame(animate);
    if (!carObject) return;

    let boosting = keys['ShiftLeft'] && nitro > 0;
    let targetSpeed = (keys['KeyW'] || keys['ArrowUp']) ? (boosting ? 2.5 : 1.5) : 0;
    speed += (targetSpeed - speed) * 0.05;

    // Movement
    if (keys['KeyA'] || keys['ArrowLeft']) {
        carObject.position.x -= speed * 0.4;
        carObject.rotation.z = 0.1;
    } else if (keys['KeyD'] || keys['ArrowRight']) {
        carObject.position.x += speed * 0.4;
        carObject.rotation.z = -0.1;
    } else {
        carObject.rotation.z = 0;
    }

    // Nitro FX
    if (boosting) {
        nitro -= 0.5;
        camera.fov = 85;
    } else {
        camera.fov = 75;
        if (nitro < 100) nitro += 0.2;
    }
    camera.updateProjectionMatrix();

    // Road Loop
    grid.position.z += speed * 25;
    if (grid.position.z > 50) grid.position.z = 0;

    // Follow Camera
    camera.position.set(carObject.position.x, 2.5, carObject.position.z + 8);
    camera.lookAt(carObject.position.x, 1, carObject.position.z - 10);

    document.getElementById('kmh').innerText = Math.floor(speed * 200);
    document.getElementById('nitro-fill').style.width = nitro + "%";

    renderer.render(scene, camera);
}
animate();
</script>
</body>
</html>
