<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Asphalt 8: Final Exam Edition</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: 'Arial Black', sans-serif; user-select: none; touch-action: none; }
        #ui { position: absolute; inset: 0; pointer-events: none; z-index: 100; color: white; }
        .speed-box { position: absolute; top: 15px; left: 20px; text-shadow: 2px 2px 4px #000; }
        #kmh-val { font-size: 45px; display: block; }
        #nitro-container { position: absolute; top: 15px; left: 50%; transform: translateX(-50%); width: 220px; height: 18px; background: rgba(0,0,0,0.5); border: 2px solid #fff; border-radius: 10px; overflow: hidden; }
        #nitro-fill { width: 0%; height: 100%; background: linear-gradient(to right, #00f2ff, #ff00ea); transition: width 0.1s; }
        #kd-msg { position: absolute; top: 25%; left: 50%; transform: translateX(-50%); color: #ffcc00; font-size: 40px; font-style: italic; opacity: 0; text-shadow: 0 0 15px #f00; z-index: 200; }
        .pedal { position: absolute; pointer-events: auto; background: rgba(0,0,0,0.5); border: 2px solid #fff; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 12px; }
        #gas-pedal { bottom: 20px; right: 20px; width: 70px; height: 140px; }
        #brake-pedal { bottom: 20px; right: 105px; width: 85px; height: 85px; border-color: #f30; }
        #handbrake { bottom: 180px; right: 20px; width: 70px; height: 50px; background: rgba(255,165,0,0.3); border: 2px solid #ffa500; border-radius: 25px; }
        .steer-btn { position: absolute; pointer-events: auto; bottom: 30px; width: 95px; height: 95px; background: rgba(255,255,255,0.1); border: 3px solid #fff; border-radius: 20px; display: flex; align-items: center; justify-content: center; font-size: 45px; }
        #left { left: 20px; }
        #right { left: 130px; }
        #loading { position: fixed; inset: 0; background: #fff; display: flex; align-items: center; justify-content: center; z-index: 1000; color: #000; }
    </style>
</head>
<body>
<div id="loading">STUDY FIRST, RACE LATER...</div>
<div id="kd-msg">KNOCKDOWN!</div>
<div id="ui">
    <div class="speed-box"><span id="kmh-val">0</span> KM/H</div>
    <div id="nitro-container"><div id="nitro-fill"></div></div>
    <div id="left" class="steer-btn">◀</div>
    <div id="right" class="steer-btn">▶</div>
    <div id="gas-pedal" class="pedal">GAS</div>
    <div id="brake-pedal" class="pedal">BRAKE</div>
    <div id="handbrake" class="pedal">P</div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB);
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);
scene.add(new THREE.AmbientLight(0xffffff, 0.8));
const sun = new THREE.DirectionalLight(0xffffff, 1.2);
sun.position.set(50, 100, 50); scene.add(sun);

const world = new THREE.Group(); scene.add(world);
const road = new THREE.Mesh(new THREE.PlaneGeometry(45, 5000), new THREE.MeshStandardMaterial({color: 0x444444}));
road.rotation.x = -Math.PI/2; world.add(road);
const grass = new THREE.Mesh(new THREE.PlaneGeometry(2000, 5000), new THREE.MeshStandardMaterial({color: 0x567d46}));
grass.rotation.x = -Math.PI/2; grass.position.y = -0.1; world.add(grass);

const bolide = new THREE.Group();
const carBody = new THREE.Mesh(new THREE.BoxGeometry(2.5, 0.6, 5.5), new THREE.MeshStandardMaterial({color: 0x0044ff, metalness: 0.8}));
bolide.add(carBody);
const wing = new THREE.Mesh(new THREE.BoxGeometry(3, 0.1, 1.4), new THREE.MeshStandardMaterial({color: 0x000}));
wing.position.set(0, 0.8, 2.2); bolide.add(wing);
scene.add(bolide);

const opponents = [];
function spawnAI(i) {
    const ai = new THREE.Mesh(new THREE.BoxGeometry(2.5, 0.6, 5), new THREE.MeshStandardMaterial({color: 0xff3300}));
    ai.position.set((Math.random()-0.5)*30, 0.3, -300 - (i * 150));
    scene.add(ai); opponents.push({mesh: ai, speed: 0.4 + Math.random()*0.3});
}
for(let i=0; i<4; i++) spawnAI(i);

const bottles = [];
function spawnBottle() {
    const b = new THREE.Mesh(new THREE.CylinderGeometry(0.5, 0.5, 2, 16), new THREE.MeshStandardMaterial({color: 0x00f2ff, emissive: 0x00f2ff, emissiveIntensity: 2}));
    b.position.set((Math.random()-0.5)*35, 1, -400 - Math.random()*400);
    scene.add(b); bottles.push(b);
}
for(let i=0; i<3; i++) spawnBottle();

let speed = 0, nitroStock = 40, boostLevel = 0, drift = false, touchY = 0;
const input = { gas: false, brake: false, left: false, right: false, hand: false };
const bind = (id, key) => {
    const el = document.getElementById(id);
    el.ontouchstart = (e) => { e.preventDefault(); input[key] = true; };
    el.ontouchend = (e) => { e.preventDefault(); input[key] = false; };
};
['left','right','gas-pedal','brake-pedal','handbrake'].forEach((id, i) => bind(id, ['left','right','gas','brake','hand'][i]));

window.ontouchstart = e => touchY = e.touches[0].clientY;
window.ontouchend = e => {
    let diff = touchY - e.changedTouches[0].clientY;
    if(diff > 50 && nitroStock > 5) { boostLevel = Math.min(3, boostLevel + 1); if(navigator.vibrate) navigator.vibrate(50 * boostLevel); } 
    if(diff < -50) { drift = !drift; if(navigator.vibrate) navigator.vibrate([40, 40]); }
};

function animate() {
    requestAnimationFrame(animate);
    let pwr = 0.035;
    if(boostLevel === 1) { pwr = 0.07; carBody.material.emissive.setHex(0x00f2ff); carBody.material.emissiveIntensity = 0.5; }
    else if(boostLevel === 2) { pwr = 0.1; carBody.material.emissive.setHex(0x00ff88); carBody.material.emissiveIntensity = 0.8; }
    else if(boostLevel === 3) { pwr = 0.16; carBody.material.emissive.setHex(0xff00ea); carBody.material.emissiveIntensity = 1.5; }
    else { carBody.material.emissiveIntensity = 0; }

    if(input.gas) speed += pwr;
    if(input.brake) { speed *= 0.8; boostLevel = 0; }
    if(!input.gas && !input.brake) speed *= 0.99;

    let turn = (drift || input.hand) ? 0.75 : 0.45;
    if(input.left) { bolide.position.x -= speed * turn; bolide.rotation.z = 0.2; }
    else if(input.right) { bolide.position.x += speed * turn; bolide.rotation.z = -0.2; }
    else { bolide.rotation.z = 0; }

    if(drift && speed > 0.1) nitroStock = Math.min(100, nitroStock + 0.3);
    if(boostLevel > 0) { nitroStock -= 0.6; if(nitroStock <= 0) { nitroStock = 0; boostLevel = 0; } camera.fov = 75 + (boostLevel * 8); } 
    else { camera.fov = 75; }
    camera.updateProjectionMatrix();

    world.position.z += speed * 35; if(world.position.z > 2500) world.position.z = 0;

    bottles.forEach(b => {
        b.position.z += speed * 35; b.rotation.y += 0.05;
        if(bolide.position.distanceTo(b.position) < 4) { nitroStock = Math.min(100, nitroStock + 35); b.position.z = -1200; b.position.x = (Math.random()-0.5)*35; }
        if(b.position.z > 50) b.position.z = -1200;
    });

    opponents.forEach(ai => {
        ai.mesh.position.z += speed * 35 - ai.speed * 35;
        if(bolide.position.distanceTo(ai.mesh.position) < 4.2) {
            if(boostLevel >= 2 || speed > 1.2) {
                document.getElementById('kd-msg').style.opacity = 1; setTimeout(() => document.getElementById('kd-msg').style.opacity = 0, 1200);
                ai.mesh.position.z = -1000; ai.mesh.position.x = (Math.random()-0.5)*30; if(navigator.vibrate) navigator.vibrate(300);
            } else { speed *= 0.6; boostLevel = 0; }
        }
        if(ai.mesh.position.z > 50) ai.mesh.position.z = -1000;
    });

    document.getElementById('nitro-fill').style.width = nitroStock + "%";
    document.getElementById('kmh-val').innerText = Math.floor(speed * 220);
    camera.position.set(bolide.position.x, 3.8, 13); camera.lookAt(bolide.position.x, 1, -5);
    renderer.render(scene, camera);
    document.getElementById('loading').style.display = 'none';
}
animate();
window.onresize = () => { camera.aspect = window.innerWidth / window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight); };
</script>
</body>
</html>
