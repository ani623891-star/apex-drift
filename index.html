<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Asphalt 8: Bugatti Bolide Canyon</title>
    <style>
        body { margin: 0; overflow: hidden; background: #87CEEB; font-family: 'Arial Black', sans-serif; user-select: none; touch-action: none; }
        #ui { position: absolute; inset: 0; pointer-events: none; z-index: 100; color: white; }
        
        /* HUD Speedo */
        .speed-box { position: absolute; top: 15px; text-align: center; text-shadow: 2px 2px 4px rgba(0,0,0,0.8); }
        #kmh-ui { left: 20px; color: #fff; font-size: 20px; }
        #kmh-val { font-size: 45px; display: block; line-height: 1; }

        /* ASPHALT 8 PEDALS (Right) */
        .pedal { position: absolute; pointer-events: auto; background: rgba(0,0,0,0.4); border: 2px solid #fff; border-radius: 12px; display: flex; align-items: center; justify-content: center; color: #fff; font-size: 12px; backdrop-filter: blur(4px); }
        #gas-pedal { bottom: 20px; right: 20px; width: 70px; height: 140px; box-shadow: inset 0 0 15px #000; }
        #brake-pedal { bottom: 20px; right: 105px; width: 85px; height: 85px; border-color: #ff3300; }
        #handbrake { position: absolute; pointer-events: auto; bottom: 180px; right: 20px; width: 70px; height: 50px; background: rgba(255,165,0,0.3); border: 2px solid #ffa500; border-radius: 25px; color: #fff; font-size: 10px; }
        
        /* STEERING (Left) */
        .steer-btn { position: absolute; pointer-events: auto; bottom: 30px; width: 95px; height: 95px; background: rgba(255,255,255,0.1); border: 3px solid #fff; border-radius: 20px; display: flex; align-items: center; justify-content: center; color: white; font-size: 45px; }
        #left { left: 20px; }
        #right { left: 130px; }

        #loading { position: fixed; inset: 0; background: #fff; display: flex; align-items: center; justify-content: center; z-index: 1000; color: #000; font-size: 20px; }
    </style>
</head>
<body>

<div id="loading">SYNCHRONIZING BUGATTI ENGINE...</div>

<div id="ui">
    <div id="kmh-ui" class="speed-box"><span id="kmh-val">0</span> KM/H</div>
    <div id="left" class="steer-btn">◀</div>
    <div id="right" class="steer-btn">▶</div>
    <div id="gas-pedal" class="pedal">GAS</div>
    <div id="brake-pedal" class="pedal">BRAKE</div>
    <div id="handbrake" class="pedal">P</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x87CEEB); // Clear Blue Sky
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 2000);
const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

// REALISTIC DAYLIGHT
const ambient = new THREE.AmbientLight(0xffffff, 0.8);
scene.add(ambient);
const sun = new THREE.DirectionalLight(0xffffff, 1.2);
sun.position.set(100, 250, 100);
sun.castShadow = true;
scene.add(sun);

// NATURAL ENVIRONMENT
const world = new THREE.Group(); scene.add(world);

// Asphalt Road
const roadMat = new THREE.MeshStandardMaterial({color: 0x444444, roughness: 0.7});
const road = new THREE.Mesh(new THREE.PlaneGeometry(45, 4000), roadMat);
road.rotation.x = -Math.PI / 2;
road.receiveShadow = true;
world.add(road);

// Grass Terrain
const grassMat = new THREE.MeshStandardMaterial({color: 0x567d46});
const grass = new THREE.Mesh(new THREE.PlaneGeometry(2000, 4000), grassMat);
grass.rotation.x = -Math.PI / 2;
grass.position.y = -0.1;
grass.receiveShadow = true;
world.add(grass);

// Canyon Rock Walls
for(let i=0; i<40; i++) {
    const rock = new THREE.Mesh(new THREE.BoxGeometry(60, 80, 120), new THREE.MeshStandardMaterial({color: 0x8b4513}));
    rock.position.set(i % 2 === 0 ? -70 : 70, 30, -i * 110);
    rock.castShadow = true;
    rock.receiveShadow = true;
    world.add(rock);
}

// BUGATTI BOLIDE - FULLY VISIBLE
const bolide = new THREE.Group();
const body = new THREE.Mesh(new THREE.BoxGeometry(2.5, 0.6, 5.5), new THREE.MeshStandardMaterial({color: 0x0000ff, metalness: 0.9, roughness: 0.1}));
body.castShadow = true;
const wing = new THREE.Mesh(new THREE.BoxGeometry(3.0, 0.1, 1.4), new THREE.MeshStandardMaterial({color: 0x000000}));
wing.position.set(0, 0.85, 2.2);
bolide.add(body, wing);
scene.add(bolide);

// PHYSICS & GESTURES
let speed = 0, nitro = 0, drift = false, touchY = 0;
const input = { gas: false, brake: false, left: false, right: false, hand: false };

const bind = (id, key) => {
    const el = document.getElementById(id);
    el.addEventListener('touchstart', (e) => { e.preventDefault(); input[key] = true; el.style.background = "rgba(255,255,255,0.4)"; });
    el.addEventListener('touchend', (e) => { e.preventDefault(); input[key] = false; el.style.background = ""; });
};
['left','right','gas-pedal','brake-pedal','handbrake'].forEach((id, i) => {
    bind(id, ['left','right','gas','brake','hand'][i]);
});

// SWIPE NITRO (UP) & DRIFT (DOWN)
window.ontouchstart = e => touchY = e.touches[0].clientY;
window.ontouchend = e => {
    let diff = touchY - e.changedTouches[0].clientY;
    if(diff > 55) { nitro = 90; if(navigator.vibrate) navigator.vibrate(120); } 
    if(diff < -55) { drift = !drift; if(navigator.vibrate) navigator.vibrate([40, 40]); }
};

function animate() {
    requestAnimationFrame(animate);
    
    if(input.gas) speed += (nitro > 0 ? 0.09 : 0.035);
    if(input.brake) speed *= 0.8;
    if(!input.gas && !input.brake) speed *= 0.99;

    let steerStr = (drift || input.hand) ? 0.75 : 0.45;
    if(input.left) { bolide.position.x -= speed * steerStr; bolide.rotation.z = 0.2; }
    else if(input.right) { bolide.position.x += speed * steerStr; bolide.rotation.z = -0.2; }
    else { bolide.rotation.z = 0; }

    // Collision Check
    if(Math.abs(bolide.position.x) > 38) {
        speed *= 0.5;
        bolide.position.x = bolide.position.x > 0 ? 37 : -37;
        if(navigator.vibrate) navigator.vibrate(200);
    }

    if(nitro > 0) { nitro--; camera.fov = 92; } else { camera.fov = 75; }
    camera.updateProjectionMatrix();

    if(drift && speed > 0.1 && navigator.vibrate) navigator.vibrate(15);

    world.position.z += speed * 35;
    if(world.position.z > 1200) world.position.z = 0;

    let k = Math.floor(speed * 215);
    document.getElementById('kmh-val').innerText = k;

    camera.position.set(bolide.position.x, 3.8, 13);
    camera.lookAt(bolide.position.x, 1, -5);
    renderer.render(scene, camera);
    document.getElementById('loading').style.display = 'none';
}
animate();

window.onresize = () => {
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth, window.innerHeight);
};
</script>
</body>
</html>
